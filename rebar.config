%% behaviours should be compiled before other files
{erl_first_files, [
    "src/cluster_elements/worker_host/worker_plugin_behaviour.erl",
    "src/modules/fslogic/check_permissions.erl",
    "deps/ctool/annotations/performance.erl"
]}.

%% directory for releases
{sub_dirs, ["rel"]}.

%% to include deps headers
{lib_dirs, ["deps"]}.

%% eunit opts - Maven-like output formatting
{eunit_opts, [verbose, {report, {eunit_surefire, [{dir, "../test/eunit_results"}]}}]}.

%% Test coverage
{cover_enabled, true}.

%% deps options
{deps, [
    {ctool, ".*", {git, "ssh://git@git.plgrid.pl:7999/vfs/ctool.git", {tag, "79eb4310c60"}}},
    {clproto, ".*", {git, "ssh://git@git.plgrid.pl:7999/vfs/clproto.git", {tag, "1d5c47a55d4"}}},
    {meck, "0.8.2", {git, "https://github.com/eproxus/meck.git", {tag, "0.8.2"}}},
    {gen_server_mock, ".*", {git, "git://github.com/brucexin/gen_server_mock.git", {tag, "de3cd8e"}}},
    {mochiweb, ".*", {git, "git://github.com/mochi/mochiweb.git", {tag, "v2.8.0"}}},
    {parse_trans, ".*", {git, "https://github.com/esl/parse_trans.git", {tag, "763462825e"}}},
    {annotations, ".*", {git, "https://github.com/hyperthunk/annotations.git", {tag, "3f257db848"}}},
    {riakc, "2.0.1", {git, "git://github.com/basho/riak-erlang-client.git", {tag, "2.0.1"}}},
    {node_package, ".*", {git, "git://github.com/xorver/node_package.git", {branch, "2.0.1"}}}
]}.

%% plugins
{plugins, [rebar_git_plugin, rebar_annotations_plugin]}.

%% pre-hooks
{pre_hooks, [
    {eunit, "mkdir -p test/eunit_results"}, %% Make dir for eunit' surefire test results
    {eunit, "epmd -daemon"}, %% Sometimes, in some cases epmd daemon doesn't start during eunit tests,
    %% so we need to force start it
    %% gen_dev compilation
    {clean, "make -C bamboos/gen_dev/ clean"},
    {compile, "make -C bamboos/gen_dev/ compile"}
]}.

{post_hooks, [
    {compile, "cp ebin/*SUITE* test_distributed/"}
]}.

%% Cleanup
{clean_files, [
    "test/eunit_results",
    "test_distributed/logs/*",
    "test_distributed/*.beam"
]}.

%% Erlang options, defines
{erl_opts, [{src_dirs, ["src", "test_distributed"]}]}.
%% Add the tuple below to erl_opts proplist to turn on lager parse transform
%% (this is not needed as long as ctool logger is used)
%% {parse_transform, lager_transform}
%% Add the tuple below to erl_opts proplist to completely turn off debug messages
%% {d, skip_debug}

%% Options for erlyDTL (templates for GUI)
{erlydtl_opts, [
    {out_dir, "ebin"}
]}.
