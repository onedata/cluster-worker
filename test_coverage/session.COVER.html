<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>/home/piotrek/Dokumenty/OneData/merge_merge/op-worker/test_coverage/session.COVER.html</title>
</head><body style='background-color: white; color: black'>
<pre>
File generated from /home/piotrek/Dokumenty/OneData/merge_merge/op-worker/ebin/../src/modules/datastore/models/session.erl by COVER 2015-08-06 at 11:00:40

****************************************************************************

        |  %%%-------------------------------------------------------------------
        |  %%% @author Tomasz Lichon
        |  %%% @copyright (C) 2015 ACK CYFRONET AGH
        |  %%% This software is released under the MIT license
        |  %%% cited in 'LICENSE.txt'.
        |  %%% @end
        |  %%%-------------------------------------------------------------------
        |  %%% @doc
        |  %%% Session management model, frequently invoked by incomming tcp
        |  %%% connections in connection
        |  %%% @end
        |  %%%-------------------------------------------------------------------
        |  -module(session).
        |  -author("Tomasz Lichon").
        |  -behaviour(model_behaviour).
        |  
        |  -include("modules/datastore/datastore_model.hrl").
        |  -include("modules/fslogic/fslogic_common.hrl").
        |  
        |  %% model_behaviour callbacks
        |  -export([save/1, get/1, list/0, exists/1, delete/1, update/2, create/1,
        |      model_init/0, 'after'/5, before/4]).
        |  
        |  %% API
        |  -export([get_session_supervisor_and_node/1, get_event_manager/1,
        |      get_sequencer_manager/1, get_communicator/1]).
        |  
        |  -export_type([id/0, identity/0]).
        |  
        |  -type id() :: binary().
        |  -type identity() :: #identity{}.
        |  
        |  %%%===================================================================
        |  %%% model_behaviour callbacks
        |  %%%===================================================================
        |  
        |  %%--------------------------------------------------------------------
        |  %% @doc
        |  %% {@link model_behaviour} callback save/1.
        |  %% @end
        |  %%--------------------------------------------------------------------
        |  -spec save(datastore:document()) -&gt; {ok, datastore:key()} | datastore:generic_error().
        |  save(Document) -&gt;
<font color=red>     0..|      datastore:save(?STORE_LEVEL, Document).</font>
        |  
        |  %%--------------------------------------------------------------------
        |  %% @doc
        |  %% {@link model_behaviour} callback update/2.
        |  %% @end
        |  %%--------------------------------------------------------------------
        |  -spec update(datastore:key(), Diff :: datastore:document_diff()) -&gt;
        |      {ok, datastore:key()} | datastore:update_error().
        |  update(Key, Diff) -&gt;
  1098..|      datastore:update(?STORE_LEVEL, ?MODULE, Key, Diff).
        |  
        |  %%--------------------------------------------------------------------
        |  %% @doc
        |  %% {@link model_behaviour} callback create/1.
        |  %% @end
        |  %%--------------------------------------------------------------------
        |  -spec create(datastore:document()) -&gt; {ok, datastore:key()} | datastore:create_error().
        |  create(Document) -&gt;
   189..|      datastore:create(?STORE_LEVEL, Document).
        |  
        |  %%--------------------------------------------------------------------
        |  %% @doc
        |  %% {@link model_behaviour} callback get/1.
        |  %% @end
        |  %%--------------------------------------------------------------------
        |  -spec get(datastore:key()) -&gt; {ok, datastore:document()} | datastore:get_error().
        |  get(?ROOT_SESS_ID) -&gt;
    77..|      {ok, #document{key = ?ROOT_SESS_ID, value = #session{identity = #identity{user_id = ?ROOT_USER_ID}}}};
        |  get(Key) -&gt;
 20918..|      datastore:get(?STORE_LEVEL, ?MODULE, Key).
        |  
        |  %%--------------------------------------------------------------------
        |  %% @doc
        |  %% Returns list of all records.
        |  %% @end
        |  %%--------------------------------------------------------------------
        |  -spec list() -&gt; {ok, [datastore:document()]} | datastore:generic_error() | no_return().
        |  list() -&gt;
    22..|      datastore:list(?STORE_LEVEL, ?MODEL_NAME, ?GET_ALL, []).
        |  
        |  %%--------------------------------------------------------------------
        |  %% @doc
        |  %% {@link model_behaviour} callback delete/1.
        |  %% @end
        |  %%--------------------------------------------------------------------
        |  -spec delete(datastore:key()) -&gt; ok | datastore:generic_error().
        |  delete(Key) -&gt;
    62..|      datastore:delete(?STORE_LEVEL, ?MODULE, Key).
        |  
        |  %%--------------------------------------------------------------------
        |  %% @doc
        |  %% {@link model_behaviour} callback exists/1.
        |  %% @end
        |  %%--------------------------------------------------------------------
        |  -spec exists(datastore:key()) -&gt; datastore:exists_return().
        |  exists(Key) -&gt;
<font color=red>     0..|      ?RESPONSE(datastore:exists(?STORE_LEVEL, ?MODULE, Key)).</font>
        |  
        |  %%--------------------------------------------------------------------
        |  %% @doc
        |  %% {@link model_behaviour} callback model_init/0.
        |  %% @end
        |  %%--------------------------------------------------------------------
        |  -spec model_init() -&gt; model_behaviour:model_config().
        |  model_init() -&gt;
 46356..|      ?MODEL_CONFIG(session_bucket, [], ?GLOBAL_ONLY_LEVEL).
        |  
        |  %%--------------------------------------------------------------------
        |  %% @doc
        |  %% {@link model_behaviour} callback 'after'/5.
        |  %% @end
        |  %%--------------------------------------------------------------------
        |  -spec 'after'(ModelName :: model_behaviour:model_type(), Method :: model_behaviour:model_action(),
        |      Level :: datastore:store_level(), Context :: term(),
        |      ReturnValue :: term()) -&gt; ok.
        |  'after'(_ModelName, _Method, _Level, _Context, _ReturnValue) -&gt;
<font color=red>     0..|      ok.</font>
        |  
        |  %%--------------------------------------------------------------------
        |  %% @doc
        |  %% {@link model_behaviour} callback before/4.
        |  %% @end
        |  %%--------------------------------------------------------------------
        |  -spec before(ModelName :: model_behaviour:model_type(), Method :: model_behaviour:model_action(),
        |      Level :: datastore:store_level(), Context :: term()) -&gt; ok | datastore:generic_error().
        |  before(_ModelName, _Method, _Level, _Context) -&gt;
<font color=red>     0..|      ok.</font>
        |  
        |  %%%===================================================================
        |  %%% API
        |  %%%===================================================================
        |  
        |  %%--------------------------------------------------------------------
        |  %% @doc
        |  %% Returns session supervisor and node on which supervisor is running.
        |  %% @end
        |  %%--------------------------------------------------------------------
        |  -spec get_session_supervisor_and_node(SessId :: id()) -&gt;
        |      {ok, {SessSup :: pid(), Node :: node()}} | {error, Reason :: term()}.
        |  get_session_supervisor_and_node(SessId) -&gt;
     7..|      case session:get(SessId) of
        |          {ok, #document{value = #session{session_sup = undefined}}} -&gt;
<font color=red>     0..|              {error, {not_found, missing}};</font>
        |          {ok, #document{value = #session{session_sup = SessSup, node = Node}}} -&gt;
     7..|              {ok, {SessSup, Node}};
        |          {error, Reason} -&gt;
<font color=red>     0..|              {error, Reason}</font>
        |      end.
        |  
        |  %%--------------------------------------------------------------------
        |  %% @doc
        |  %% Returns event manager associated with session.
        |  %% @end
        |  %%--------------------------------------------------------------------
        |  -spec get_event_manager(SessId :: id()) -&gt;
        |      {ok, EvtMan :: pid()} | {error, Reason :: term()}.
        |  get_event_manager(SessId) -&gt;
  7271..|      case session:get(SessId) of
        |          {ok, #document{value = #session{event_manager = undefined}}} -&gt;
<font color=red>     0..|              {error, {not_found, missing}};</font>
        |          {ok, #document{value = #session{event_manager = EvtMan}}} -&gt;
  7271..|              {ok, EvtMan};
        |          {error, Reason} -&gt;
<font color=red>     0..|              {error, Reason}</font>
        |      end.
        |  
        |  %%--------------------------------------------------------------------
        |  %% @doc
        |  %% Returns sequencer manager associated with session.
        |  %% @end
        |  %%--------------------------------------------------------------------
        |  -spec get_sequencer_manager(SessId :: id()) -&gt;
        |      {ok, SeqMan :: pid()} | {error, Reason :: term()}.
        |  get_sequencer_manager(SessId) -&gt;
   877..|      case session:get(SessId) of
        |          {ok, #document{value = #session{sequencer_manager = undefined}}} -&gt;
<font color=red>     0..|              {error, {not_found, missing}};</font>
        |          {ok, #document{value = #session{sequencer_manager = SeqMan}}} -&gt;
   877..|              {ok, SeqMan};
        |          {error, Reason} -&gt;
<font color=red>     0..|              {error, Reason}</font>
        |      end.
        |  
        |  %%--------------------------------------------------------------------
        |  %% @doc
        |  %% Returns communicator associated with session.
        |  %% @end
        |  %%--------------------------------------------------------------------
        |  -spec get_communicator(SessId :: id()) -&gt;
        |      {ok, Comm :: pid()} | {error, Reason :: term()}.
        |  get_communicator(SessId) -&gt;
 11272..|      case session:get(SessId) of
        |          {ok, #document{value = #session{communicator = undefined}}} -&gt;
<font color=red>     0..|              {error, {not_found, missing}};</font>
        |          {ok, #document{value = #session{communicator = Comm}}} -&gt;
 11183..|              {ok, Comm};
        |          {error, Reason} -&gt;
    89..|              {error, Reason}
        |      end.
</pre>
</body>
</html>
