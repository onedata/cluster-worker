<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>/home/piotrek/Dokumenty/OneData/merge_merge/op-worker/test_coverage/fslogic_errors.COVER.html</title>
</head><body style='background-color: white; color: black'>
<pre>
File generated from /home/piotrek/Dokumenty/OneData/merge_merge/op-worker/ebin/../src/modules/fslogic/fslogic_errors.erl by COVER 2015-08-06 at 11:00:40

****************************************************************************

        |  %% ===================================================================
        |  %% @author Rafal Slota
        |  %% @copyright (C): 2015, ACK CYFRONET AGH
        |  %% This software is released under the MIT license
        |  %% cited in 'LICENSE.txt'.
        |  %% @end
        |  %% ===================================================================
        |  %% @doc: This module provides error translators for generic fslogic errors.
        |  %% @end
        |  %% ===================================================================
        |  -module(fslogic_errors).
        |  -author("Rafal Slota").
        |  
        |  -include("modules/fslogic/fslogic_common.hrl").
        |  -include("proto/oneclient/common_messages.hrl").
        |  -include_lib("ctool/include/logging.hrl").
        |  
        |  %% API
        |  -export([gen_status_message/1, posix_to_internal/1, internal_to_posix/1]).
        |  
        |  %%%===================================================================
        |  %%% API functions
        |  %%%===================================================================
        |  
        |  %%--------------------------------------------------------------------
        |  %% @doc Translates operation error to status messages.
        |  %%      This function is intended to be extended when new translation is needed.
        |  %%--------------------------------------------------------------------
        |  -spec gen_status_message(Error :: term()) -&gt; #status{}.
        |  gen_status_message({error, Reason}) -&gt;
     3..|      gen_status_message(Reason);
        |  gen_status_message({not_found, file_meta}) -&gt;
     3..|      #status{code = ?ENOENT, description = describe_error(?ENOENT)};
        |  gen_status_message(Error) when is_atom(Error) -&gt;
    97..|      case lists:member(Error, ?ERROR_CODES) of
    97..|          true -&gt; #status{code = Error};
<font color=red>     0..|          false -&gt; #status{code = ?EREMOTEIO, description = describe_error(Error)}</font>
        |      end;
        |  gen_status_message({ErrorCode, ErrorDescription}) when
        |      is_atom(ErrorCode) and is_binary(ErrorDescription) -&gt;
<font color=red>     0..|      case lists:member(ErrorCode, ?ERROR_CODES) of</font>
<font color=red>     0..|          true -&gt; #status{code = ErrorCode, description = ErrorDescription};</font>
<font color=red>     0..|          false -&gt; #status{code = ?EREMOTEIO, description = ErrorDescription}</font>
        |      end;
        |  gen_status_message(_) -&gt;
<font color=red>     0..|      #status{code = ?EREMOTEIO, description = &lt;&lt;"An unknown error occured."&gt;&gt;}.</font>
        |  
        |  %%--------------------------------------------------------------------
        |  %% @doc Translates POSIX error code to internal error code.
        |  %% @end
        |  %%--------------------------------------------------------------------
        |  -spec posix_to_internal(POSIXErrorCode :: integer()) -&gt;
        |      InternalErrorCode :: code().
        |  posix_to_internal(Code) when is_integer(Code), Code &lt; 0 -&gt;
<font color=red>     0..|      posix_to_internal(Code * -1);</font>
        |  posix_to_internal(1) -&gt;
<font color=red>     0..|      ?EPERM;</font>
        |  posix_to_internal(2) -&gt;
<font color=red>     0..|      ?ENOENT;</font>
        |  posix_to_internal(17) -&gt;
<font color=red>     0..|      ?EEXIST;</font>
        |  posix_to_internal(13) -&gt;
<font color=red>     0..|      ?EACCES;</font>
        |  posix_to_internal(122) -&gt;
<font color=red>     0..|      ?EDQUOT;</font>
        |  posix_to_internal(22) -&gt;
<font color=red>     0..|      ?EINVAL;</font>
        |  posix_to_internal(39) -&gt;
<font color=red>     0..|      ?ENOTEMPTY;</font>
        |  posix_to_internal(95) -&gt;
<font color=red>     0..|      ?ENOTSUP;</font>
        |  posix_to_internal(_) -&gt;
<font color=red>     0..|      ?EREMOTEIO.</font>
        |  
        |  %%--------------------------------------------------------------------
        |  %% @doc Translates internal error code to POSIX error code.
        |  %% @end
        |  %%--------------------------------------------------------------------
        |  -spec internal_to_posix(InternalErrorCode :: code()) -&gt;
        |      POSIXErrorCode :: non_neg_integer().
        |  internal_to_posix(?OK) -&gt;
<font color=red>     0..|      0;</font>
        |  internal_to_posix(?EPERM) -&gt;
<font color=red>     0..|      1;</font>
        |  internal_to_posix(?ENOENT) -&gt;
<font color=red>     0..|      2;</font>
        |  internal_to_posix(?EEXIST) -&gt;
<font color=red>     0..|      17;</font>
        |  internal_to_posix(?EACCES) -&gt;
<font color=red>     0..|      13;</font>
        |  internal_to_posix(?EDQUOT) -&gt;
<font color=red>     0..|      122;</font>
        |  internal_to_posix(?EINVAL) -&gt;
<font color=red>     0..|      22;</font>
        |  internal_to_posix(?ENOTEMPTY) -&gt;
<font color=red>     0..|      39;</font>
        |  internal_to_posix(?ENOTSUP) -&gt;
<font color=red>     0..|      95;</font>
        |  internal_to_posix(_) -&gt;
<font color=red>     0..|      121.</font>
        |  
        |  %%%===================================================================
        |  %%% Internal functions
        |  %%%===================================================================
        |  
        |  %%--------------------------------------------------------------------
        |  %% @doc
        |  %% Translates error ID to error description.
        |  %% @end
        |  %%--------------------------------------------------------------------
        |  -spec describe_error(ErrorId :: atom()) -&gt; ErrorDescription :: binary().
        |  describe_error(ErrorId) -&gt;
     3..|      case lists:keyfind(ErrorId, 1, ?ERROR_DESCRIPTIONS) of
<font color=red>     0..|          {ErrorId, ErrorDescription} -&gt; ErrorDescription;</font>
     3..|          false -&gt; atom_to_binary(ErrorId, utf8)
        |      end.</pre>
</body>
</html>
