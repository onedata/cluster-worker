<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>/home/piotrek/Dokumenty/OneData/merge_merge/op-worker/test_coverage/event_utils.COVER.html</title>
</head><body style='background-color: white; color: black'>
<pre>
File generated from /home/piotrek/Dokumenty/OneData/merge_merge/op-worker/ebin/../src/modules/event_manager/event_utils.erl by COVER 2015-08-06 at 11:00:45

****************************************************************************

        |  %%%-------------------------------------------------------------------
        |  %%% @author Krzysztof Trzepla
        |  %%% @copyright (C) 2015 ACK CYFRONET AGH
        |  %%% This software is released under the MIT license
        |  %%% cited in 'LICENSE.txt'.
        |  %%% @end
        |  %%%-------------------------------------------------------------------
        |  %%% @doc
        |  %%% This file contains utility functions for events management.
        |  %%% @end
        |  %%%-------------------------------------------------------------------
        |  -module(event_utils).
        |  -author("Krzysztof Trzepla").
        |  
        |  -include("proto/oneclient/common_messages.hrl").
        |  
        |  %% API
        |  -export([aggregate_blocks/2]).
        |  
        |  -export_type([file_block/0]).
        |  
        |  -type file_block() :: #file_block{}.
        |  
        |  %%%===================================================================
        |  %%% API
        |  %%%===================================================================
        |  
        |  %%--------------------------------------------------------------------
        |  %% @doc
        |  %% Aggregates lists of 'file_block' records.
        |  %% IMPORTANT! Both list should contain disjoint file blocks sorted in ascending
        |  %% order of block offset.
        |  %% @end
        |  %%--------------------------------------------------------------------
        |  -spec aggregate_blocks(Blocks1 :: [file_block()], Blocks2 :: [file_block()]) -&gt;
        |      AggBlocks :: [file_block()].
        |  aggregate_blocks([], Blocks) -&gt;
  2436..|      Blocks;
        |  aggregate_blocks(Blocks, []) -&gt;
     1..|      Blocks;
        |  aggregate_blocks(Blocks1, Blocks2) -&gt;
  3827..|      aggregate_blocks(Blocks1, Blocks2, []).
        |  
        |  %%%===================================================================
        |  %%% Internal functions
        |  %%%===================================================================
        |  
        |  %%--------------------------------------------------------------------
        |  %% @private
        |  %% @doc
        |  %% Aggregates lists of 'file_block' records using acumulator AggBlocks.
        |  %% @end
        |  %%--------------------------------------------------------------------
        |  -spec aggregate_blocks(Blocks1 :: [file_block()], Blocks2 :: [file_block()],
        |      AggBlocks :: [file_block()]) -&gt; NewAggBlocks :: [file_block()].
        |  aggregate_blocks([], [], AggBlocks) -&gt;
  3827..|      lists:reverse(AggBlocks);
        |  aggregate_blocks([], [Block | Blocks], AggBlocks) -&gt;
  2225..|      aggregate_blocks([], Blocks, aggregate_block(Block, AggBlocks));
        |  aggregate_blocks([Block | Blocks], [], AggBlocks) -&gt;
  1652..|      aggregate_blocks(Blocks, [], aggregate_block(Block, AggBlocks));
        |  aggregate_blocks([#file_block{offset = Offset1} = Block1 | Blocks1],
        |      [#file_block{offset = Offset2} | _] = Blocks2, AggBlocks)
        |      when Offset1 &lt; Offset2 -&gt;
  2275..|      aggregate_blocks(Blocks1, Blocks2, aggregate_block(Block1, AggBlocks));
        |  aggregate_blocks(Blocks1, [#file_block{} = Block2 | Blocks2], AggBlocks) -&gt;
  1653..|      aggregate_blocks(Blocks1, Blocks2, aggregate_block(Block2, AggBlocks)).
        |  
        |  %%--------------------------------------------------------------------
        |  %% @private
        |  %% @doc
        |  %% Aggregates 'file_block' record  with list of 'file_block' records.
        |  %% @end
        |  %%--------------------------------------------------------------------
        |  -spec aggregate_block(Block :: file_block(), Blocks :: [file_block()]) -&gt;
        |      AggBlocks :: [file_block()].
        |  aggregate_block(Block, []) -&gt;
  3827..|      [Block];
        |  aggregate_block(#file_block{offset = Offset1, size = Size1},
        |      [#file_block{offset = Offset2, size = Size2} | Blocks])
        |      when Offset1 =&lt; Offset2 + Size2 -&gt;
  3972..|      [#file_block{
        |          offset = Offset2,
        |          size = max(Offset1 + Size1, Offset2 + Size2) - Offset2
        |      } | Blocks];
        |  aggregate_block(Block, Blocks) -&gt;
     6..|      [Block | Blocks].</pre>
</body>
</html>
